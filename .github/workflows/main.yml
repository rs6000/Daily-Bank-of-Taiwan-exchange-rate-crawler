name: Daily Exchange Rate Crawler (BOT - TPE Time)

on:
  # æ¯æ—¥æ’ç¨‹è§¸ç™¼ï¼š
  # é€™è£¡è¨­ç½®ç‚ºæ¯å¤© UTC æ™‚é–“ 01:00 åŸ·è¡Œã€‚
  # æ›ç®—æˆå°åŒ—æ™‚é–“ (GMT+8) ç´„ç‚º ä¸Šåˆ 9 é»
  schedule:
    - cron: '0 1 * * *' 
  
  # å…è¨±æ‚¨éš¨æ™‚æ‰‹å‹•é»æ“ŠæŒ‰éˆ•ä¾†é‹è¡Œå·¥ä½œæµ (æ–¹ä¾¿æ¸¬è©¦)
  workflow_dispatch:

jobs:
  update-rates:
    runs-on: ubuntu-latest
    
    # *** é—œéµä¿®æ­£ï¼šæˆäºˆ Action å¯«å…¥ (write) æ¬Šé™ï¼Œä»¥è§£æ±º Permission denied éŒ¯èª¤ ***
    permissions:
      contents: write 
    
    steps:
      # 1. æª¢æŸ¥ç¨‹å¼ç¢¼
      - name: Checkout repository code
        uses: actions/checkout@v4
        # ç”±æ–¼é ‚å±¤å·²ç¶“è¨­å®šäº† permissions: contents: writeï¼Œé€™è£¡ä¸éœ€è¦é¡å¤–çš„ token åƒæ•¸
        
      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 

      # 3. å®‰è£çˆ¬èŸ²æ‰€éœ€çš„ä¾è³´ (åŒ…å« lxml, pytz)
      - name: Install dependencies (pandas, html5lib, pytz, lxml)
        run: pip install pandas html5lib pytz lxml
        
      # 4. åŸ·è¡Œçˆ¬èŸ²ç¨‹å¼
      - name: Run Crawler and Generate JSON
        # *** è«‹ç¢ºä¿é€™è£¡çš„æª”æ¡ˆåç¨±èˆ‡æ‚¨å¯¦éš›ä½¿ç”¨çš„ Python æª”æ¡ˆåç¨±ä¸€è‡´ ***
        run: python Exhange-Rates-Gemini.py
        
      # 5. è‡ªå‹•æäº¤å’Œæ¨é€è®Šæ›´
      - name: Commit and Push new data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # åªæäº¤ç”Ÿæˆçš„ JSON æª”æ¡ˆ
          file_pattern: 'data/rates.json'
          # æäº¤è¨Šæ¯
          commit_message: 'ğŸ¤– Daily BOT Rate Update (TPE Time): ${{ github.event.repository.name }}'
          # è¨­ç½®æäº¤è€…çš„åç¨±å’Œéƒµä»¶åœ°å€
          commit_user_name: 'GitHub Action Bot' 
          commit_user_email: 'action@github.com'
